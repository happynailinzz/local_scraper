{% extends "base.html" %}
{% block body %}
<div class="card">
  <div class="h">运行详情</div>
  <div class="muted">run_id: {{ run_id }}</div>
  {% if row %}
    <div class="muted">started_at: {{ row.started_at }} | status: {{ row.status }} | duration: {{ row.duration_seconds or '-' }}</div>
  {% else %}
    <div class="muted">(本次运行由 WebUI 启动；DB 记录需要 run 结束后写入)</div>
  {% endif %}
</div>

<div class="card">
  <div class="h">实时日志</div>
  {% if log_file %}
    <div class="muted">log_file: {{ log_file }}</div>
  {% endif %}
  <pre id="log"></pre>
  <div class="muted" id="status"></div>
</div>

<script>
  const logEl = document.getElementById('log');
  const statusEl = document.getElementById('status');
  const es = new EventSource(`/runs/{{ run_id }}/stream`);
  es.onmessage = (e) => {
    logEl.textContent += e.data + "\n";
    logEl.scrollTop = logEl.scrollHeight;
  };
  es.addEventListener('end', (e) => {
    statusEl.textContent = `done: ${e.data}`;
    es.close();
  });
</script>

{% endblock %}
